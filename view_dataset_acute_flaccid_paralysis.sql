DROP VIEW IF EXISTS view_dataset_acute_flaccid_paralysis;
CREATE VIEW view_dataset_acute_flaccid_paralysis AS
SELECT 
    (doc ->> 'ident')::text AS case_unique_id,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'given'::text ->> 'df_value') AS case_given_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'family'::text ->> 'df_value') AS case_family_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'gender'::text ->> 'df_value') AS case_gender,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'country'::text ->> 'df_value') AS case_residential_country,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'county'::text ->> 'df_value') AS case_residential_county,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'subcounty'::text ->> 'df_value') AS case_residential_subcounty,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_of_birth'::text ->> 'df_value')::text AS case_date_of_birth,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_years'::text ->> 'df_value')::float AS case_age_years,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_months'::text ->> 'df_value')::float AS case_age_months,
    CASE
        WHEN (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_years'::text ->> 'df_value')::float < 2 THEN 'Under 2 yrs'
        WHEN (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_years'::text ->> 'df_value')::float BETWEEN 2 AND 5 THEN '2-5 yrs'
        WHEN (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_years'::text ->> 'df_value')::float BETWEEN 5 AND 16 THEN '5-16 yrs'
        WHEN (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'age_years'::text ->> 'df_value')::float > 16 THEN '16 and above years'
        ELSE 'Unknown'
    END AS age_group,
    CASE
        WHEN lower((((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'gender'::text ->> 'df_value')) = 'male' THEN 'Male'
        WHEN lower((((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'gender'::text ->> 'df_value')) = 'female' THEN 'Female'
        ELSE 'Unknown'
    END as gender,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'phone_number'::text ->> 'df_value') AS case_phone_number,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'occupation'::text ->> 'df_value') AS case_occupation,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'occupation_other'::text ->> 'df_value') AS case_occupation_other,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'title_residence'::text ->> 'df_value') AS case_title_residence,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'town_village_camp'::text ->> 'df_value') AS case_town_village_camp,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'landmark'::text ->> 'df_value') AS case_landmark,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'title_parent_guradian'::text ->> 'df_value') AS case_title_parent_guradian,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'guardian_family_name'::text ->> 'df_value') AS case_guardian_family_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'guardian_given_name'::text ->> 'df_value') AS case_guardian_given_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'guardian_phone_number'::text ->> 'df_value') AS case_guardian_phone_number,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'title_respondent'::text ->> 'df_value') AS case_title_respondent,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent'::text ->> 'df_value') AS case_respondent,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent_family_name'::text ->> 'df_value') AS case_respondent_family_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent_given_name'::text ->> 'df_value') AS case_respondent_given_name,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent_address'::text ->> 'df_value') AS case_respondent_address,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent_phone_number'::text ->> 'df_value') AS case_respondent_phone_number,
    (((doc -> 'DForms'::text) -> 'case_demographics'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'respondent_relationship'::text ->> 'df_value') AS case_respondent_relationship,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_of_onset'::text ->> 'df_value')::text AS case_paralysis_date_of_onset,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'fever_at_onset_of_paralysis'::text ->> 'df_value') AS fever_at_onset_of_paralysis,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'progressive_paralysis'::text ->> 'df_value') AS progressive_paralysis,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'paralysis_acute_and_flaccid'::text ->> 'df_value') AS paralysis_acute_and_flaccid,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'paralysis_asymmetrical'::text ->> 'df_value') AS paralysis_asymmetrical,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'paralysis_site'::text ->> 'df_value') AS paralysis_site,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'paralysis_site_other'::text ->> 'df_value') AS paralysis_site_other,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'paralyzed_limb_sensitive_to_pain'::text ->> 'df_value') AS paralyzed_limb_sensitive_to_pain,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'injection_before_paralysis'::text ->> 'df_value') AS injection_before_paralysis,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'injection_site'::text ->> 'df_value') AS injection_site,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'provisial_diagnosis'::text ->> 'df_value') AS provisional_diagnosis,
    (((doc -> 'DForms'::text) -> 'case_investigation_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'outcome'::text ->> 'df_value') AS case_outcome,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'record_exposure'::text ->> 'df_value') AS record_exposure,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'exposure_type'::text ->> 'df_value') AS exposure_type,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'food_name'::text ->> 'df_value') AS food_name,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'food_consumption_date'::text ->> 'df_value')::text AS food_consumption_date,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'food_source'::text ->> 'df_value') AS food_source,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'food_participants_count'::text ->> 'df_value')::float AS food_participants_count,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'food_affected_participants_count'::text ->> 'df_value')::float AS food_affected_participants_count,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'water_sources'::text ->> 'df_value') AS water_sources,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'water_sources_other'::text ->> 'df_value') AS water_sources_other,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'toilet_types'::text ->> 'df_value') AS toilet_types,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'toilet_types_other'::text ->> 'df_value') AS toilet_types_other,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_origin_country'::text ->> 'df_value') AS travel_origin_country,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_origin_city'::text ->> 'df_value') AS travel_origin_city,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_departure_date'::text ->> 'df_value')::text AS travel_departure_date,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_destination_country'::text ->> 'df_value') AS travel_destination_country,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_destination_city'::text ->> 'df_value') AS travel_destination_city,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'travel_arrival_date'::text ->> 'df_value')::text AS travel_arrival_date,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'animal_exposure'::text ->> 'df_value') AS animal_exposure,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'animal_exposure_other'::text ->> 'df_value') AS animal_exposure_other,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'animal_species'::text ->> 'df_value') AS animal_species,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'animal_species_other'::text ->> 'df_value') AS animal_species_other,
    (((doc -> 'DForms'::text) -> 'case_exposure'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'animal_exposure_location'::text ->> 'df_value') AS animal_exposure_location,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'total_vaccine_doses'::text ->> 'df_value')::float AS total_vaccine_doses,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_of_opv_doses_at_birth'::text ->> 'df_value')::text AS date_of_opv_doses_at_birth,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'first_dose_date'::text ->> 'df_value')::text AS first_dose_date,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'second_dose_date'::text ->> 'df_value')::text AS second_dose_date,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'third_dose_date'::text ->> 'df_value')::text AS third_dose_date,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'fourth_dose_date'::text ->> 'df_value')::text AS fourth_dose_date,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'last_dose_date'::text ->> 'df_value')::text AS last_dose_date,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'last_opv_sia_dose'::text ->> 'df_value')::text AS last_opv_sia_dose,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'total_opv_sia_doses'::text ->> 'df_value')::float AS total_opv_sia_doses,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'total_opv_ri_doses'::text ->> 'df_value')::float AS total_opv_ri_doses,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'total_ipv_sia_doses'::text ->> 'df_value')::float AS total_ipv_sia_doses,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'total_ipv_ri_doses'::text ->> 'df_value')::float AS total_ipv_ri_doses,
    (((doc -> 'DForms'::text) -> 'vaccination_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_ipv_sia_ri'::text ->> 'df_value')::text AS date_ipv_sia_ri,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'stool_condition'::text ->> 'df_value') AS stool_condition,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_final_culture_result_available'::text ->> 'df_value')::text AS date_final_culture_result_available,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_specimen_received_in_ic_lab'::text ->> 'df_value')::text AS date_specimen_received_in_ic_lab,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'lab_id'::text ->> 'df_value') AS lab_id,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'final_cell_culture_result'::text ->> 'df_value') AS final_cell_culture_result,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_results_sent_to_national_epi'::text ->> 'df_value')::text AS date_results_sent_to_national_epi,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_isolate_sent_by_national_laboratory_to_regional_laboratory'::text ->> 'df_value')::text AS date_isolate_sent_by_national_laboratory_to_regional_laboratory,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_itd_results_sent_by_regional_laboratory'::text ->> 'df_value')::text AS date_itd_results_sent_by_regional_laboratory,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_itd_results_received_by_county'::text ->> 'df_value')::text AS date_itd_results_received_by_county,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_isolate_sent_for_sequencing'::text ->> 'df_value')::text AS date_isolate_sent_for_sequencing,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_final_results_sent_to_epi'::text ->> 'df_value')::text AS date_final_results_sent_to_epi,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'title_final_results'::text ->> 'df_value') AS title_final_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'w1_results'::text ->> 'df_value') AS w1_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'w2_results'::text ->> 'df_value') AS w2_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'w3_results'::text ->> 'df_value') AS w3_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'discordant_sabin'::text ->> 'df_value') AS discordant_sabin,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'sl1_results'::text ->> 'df_value') AS sl1_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'sl2_results'::text ->> 'df_value') AS sl2_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'sl3_results'::text ->> 'df_value') AS sl3_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'VDPV1_results'::text ->> 'df_value') AS vdpv1_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'VDPV2_results'::text ->> 'df_value') AS vdpv2_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'VDPV3_results'::text ->> 'df_value') AS vdpv3_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'RNEV_results'::text ->> 'df_value') AS rnev_results,
    (((doc -> 'DForms'::text) -> 'specimen_results_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'RNPENT_results'::text ->> 'df_value') AS rnpent_results,
    (((doc -> 'DForms'::text) -> 'specimen_collection_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_first_specimen_collected'::text ->> 'df_value')::text AS date_first_specimen_collected,
    (((doc -> 'DForms'::text) -> 'specimen_collection_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_second_specimen_collected'::text ->> 'df_value')::text AS date_second_specimen_collected,
    (((doc -> 'DForms'::text) -> 'specimen_collection_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_specimen_sent_to_national'::text ->> 'df_value')::text AS date_specimen_sent_to_national,
    (((doc -> 'DForms'::text) -> 'specimen_collection_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_specimen_received_at_national'::text ->> 'df_value')::text AS date_specimen_received_at_national,
    (((doc -> 'DForms'::text) -> 'specimen_collection_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'date_specimen_sent_to_lab'::text ->> 'df_value')::text AS date_specimen_sent_to_lab,
    (((doc -> 'DForms'::text) -> 'final_classification_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'immunocompromised_status_suspected'::text ->> 'df_value') AS immunocompromised_status_suspected,
    (((doc -> 'DForms'::text) -> 'final_classification_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'afp_final_case_classification'::text ->> 'df_value') AS afp_final_case_classification,
    (((doc -> 'DForms'::text) -> 'final_classification_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'afp_vdpv_serotype'::text ->> 'df_value') AS afp_vdpv_serotype,
    (((doc -> 'DForms'::text) -> 'patient_movements_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'place'::text ->> 'df_value') AS patient_movement_place,
    (((doc -> 'DForms'::text) -> 'patient_movements_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'duration_months'::text ->> 'df_value')::float AS patient_movement_duration_months,
    (((doc -> 'DForms'::text) -> 'patient_movements_afp'::text) -> 0 -> 'DFields'::text -> 'values'::text -> 'duration_days'::text ->> 'df_value')::float AS patient_movement_duration_days,
    ((doc -> 'DFields'::text) -> 'values'::text -> 'date_of_investigation'::text ->> 'df_value')::text AS case_investigation_date,
    ((doc -> 'DFields'::text) -> 'values'::text -> 'EPID'::text ->> 'df_value') AS epid,
    ((doc -> 'DFields'::text) -> 'values'::text -> 'disease'::text ->> 'df_value') AS disease,
    doc ->> 'fform_id' AS fform_id,
    ((doc -> 'location'::text) ->> 'accuracy')::float AS location_accuracy,
    ((doc -> 'location'::text) ->> 'latitude')::FLOAT AS location_latitude,
    ((doc -> 'location'::text) ->> 'longitude')::FLOAT AS location_longitude,
    doc ->> 'mform_id' AS mform_id,
    doc ->> 'created_username' AS created_username,
    to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS') AS created_timestamp,
    doc ->> 'modified_username' AS modified_username,
    to_timestamp(doc ->> 'modified_timestamp', 'DD/MM/YYYY HH24:MI:SS') AS modified_timestamp,
    date_part('week', to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS')) AS case_week,
    date_part('day', to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS')) AS case_day,
    date_part('month', to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS')) AS case_month,
    date_part('year', to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS')) AS case_year,
    to_char(to_timestamp(doc ->> 'created_timestamp', 'DD/MM/YYYY HH24:MI:SS'), 'YYYY "W"IW') AS case_year_week,
    doc
FROM couchdb
WHERE 
    (doc ->> 'type') = 'dform'
    AND (doc -> 'DFields'::text -> 'values'::text -> 'disease'::text ->> 'df_value') = 'AFP'
    AND (doc ->> 'ident') IS NOT NULL;

ALTER TABLE view_dataset_acute_flaccid_paralysis
    OWNER TO postgres_root;